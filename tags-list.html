<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag List / タグ一覧</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        margin: 0;
        padding: 32px 20px;
        background: #ffffff;
        color: #111111;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
      }
      h2 {
        font-size: 18px;
        margin: 24px 0 8px;
      }
      h3 {
        font-size: 15px;
        margin: 16px 0 6px;
        color: #374151;
        font-weight: 600;
      }
      h4 {
        font-size: 14px;
        margin: 12px 0 4px;
        color: #4b5563;
        font-weight: 600;
      }
      h5 {
        font-size: 13px;
        margin: 10px 0 4px;
        color: #6b7280;
        font-weight: 600;
      }
      p {
        line-height: 1.6;
        margin: 12px 0;
      }
      .muted {
        color: #4b5563;
        font-size: 13px;
      }
      .search {
        margin-top: 16px;
        margin-bottom: 12px;
      }
      input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        font-size: 14px;
      }
      .count {
        margin-top: 6px;
        font-size: 13px;
        color: #6b7280;
      }
      .section {
        border-top: 1px solid #e5e7eb;
        padding-top: 16px;
        margin-top: 16px;
      }
      .tag {
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        margin: 8px 0;
        background: #f9fafb;
      }
      .tag-title {
        font-weight: 700;
      }
      .tag-title a {
        color: #111111;
        text-decoration: none;
      }
      .tag-title a:hover {
        text-decoration: underline;
      }
      .tag-en {
        color: #6b7280;
        font-size: 13px;
        margin-left: 6px;
        text-decoration: none;
      }
      .tag-alt {
        color: #6b7280;
        font-size: 13px;
        margin-left: 6px;
      }
      .tag-en:hover {
        text-decoration: underline;
      }
      .tag-meta {
        color: #6b7280;
        font-size: 12px;
        margin-top: 6px;
      }
      .bilingual {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 16px;
        align-items: start;
      }
      .bilingual > div > p:first-child {
        margin-top: 0;
      }
      @media (max-width: 860px) {
        .bilingual {
          grid-template-columns: 1fr;
        }
      }
      a {
        color: #2563eb;
      }
      .lang-switcher { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 20px; align-items: center; }
      .lang-switcher span { font-size: 13px; color: #4b5563; margin-right: 4px; }
      .lang-btn { padding: 6px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; font-size: 14px; cursor: pointer; color: #374151; }
      .lang-btn:hover { background: #f9fafb; border-color: #d1d5db; }
      .lang-btn.active { background: #2563eb; border-color: #2563eb; color: #fff; }
      .lang-block { display: none; }
      .lang-block.lang-visible { display: block; }
      body[data-lang] .bilingual { grid-template-columns: 1fr; }
      body[data-lang] .bilingual .lang-block.lang-visible { display: block; }
      body[data-lang] .bilingual .lang-block:not(.lang-visible) { display: none; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="lang-block lang-visible" data-lang="en">Tag List</h1>
      <h1 class="lang-block" data-lang="ja">タグ一覧</h1>
      <h1 class="lang-block" data-lang="ko">태그 목록</h1>
      <h1 class="lang-block" data-lang="pt">Lista de tags</h1>
      <h1 class="lang-block" data-lang="es">Lista de etiquetas</h1>
      <h1 class="lang-block" data-lang="fr">Liste des tags</h1>
      <p class="lang-block lang-visible muted" data-lang="en"><strong>Last updated:</strong> 2026-01-29</p>
      <p class="lang-block muted" data-lang="ja"><strong>更新日:</strong> 2026-01-29</p>
      <p class="lang-block muted" data-lang="ko"><strong>최종 업데이트:</strong> 2026-01-29</p>
      <p class="lang-block muted" data-lang="pt"><strong>Última atualização:</strong> 2026-01-29</p>
      <p class="lang-block muted" data-lang="es"><strong>Última actualización:</strong> 2026-01-29</p>
      <p class="lang-block muted" data-lang="fr"><strong>Dernière mise à jour:</strong> 2026-01-29</p>

      <div class="lang-switcher" role="group" aria-label="Language / 言語">
        <span class="lang-label">Language / 言語:</span>
        <button type="button" class="lang-btn active" data-lang="en" aria-pressed="true">English</button>
        <button type="button" class="lang-btn" data-lang="ja" aria-pressed="false">日本語</button>
        <button type="button" class="lang-btn" data-lang="ko" aria-pressed="false">한국어</button>
        <button type="button" class="lang-btn" data-lang="pt" aria-pressed="false">Português</button>
        <button type="button" class="lang-btn" data-lang="es" aria-pressed="false">Español</button>
        <button type="button" class="lang-btn" data-lang="fr" aria-pressed="false">Français</button>
      </div>

      <div class="bilingual">
        <div class="lang-block lang-visible" data-lang="en">
          <p>
            Use the search box to filter tags. Tags are grouped into Position, Scenario, Setup, Action,
            Submission, and Source. Within Setup, body-part tags are grouped by body region (e.g. Collar, Knee, Waist).
          </p>
        </div>
        <div class="lang-block" data-lang="ja">
          <p>
            検索欄でタグを絞り込みできます。タグはポジション / シナリオ / セットアップ /
            アクション / サブミッション / ソースのカテゴリで整理しています。セットアップのうち部位タグは、体の部位（えり周り・ひざ周り・こし周りなど）ごとにまとめています。
          </p>
        </div>
        <div class="lang-block" data-lang="ko">
          <p>
            검색창으로 태그를 필터링할 수 있습니다. 태그는 포지션, 시나리오, 셋업, 액션, 서브미션, 소스로 구분되며, 셋업 중 부위 태그는 부위(칼라·무릎·허리 등)별로 묶어 표시합니다.
          </p>
        </div>
        <div class="lang-block" data-lang="pt">
          <p>
            Use a caixa de pesquisa para filtrar tags. As tags estão agrupadas em Posição, Cenário, Preparação, Ação, Finalização e Fonte. Na Preparação, as tags de parte do corpo estão agrupadas por região (ex.: Gola, Joelho, Cintura).
          </p>
        </div>
        <div class="lang-block" data-lang="es">
          <p>
            Usa el cuadro de búsqueda para filtrar etiquetas. Las etiquetas se agrupan en Posición, Escenario, Preparación, Acción, Finalización y Fuente. En Preparación, las etiquetas de partes del cuerpo se agrupan por región (ej. Cuello, Rodilla, Cintura).
          </p>
        </div>
        <div class="lang-block" data-lang="fr">
          <p>
            Utilisez la zone de recherche pour filtrer les tags. Les tags sont regroupés en Position, Scénario, Préparation, Action, Soumission et Source. Dans Préparation, les tags de partie du corps sont regroupés par région (ex. Col, Genou, Taille).
          </p>
        </div>
      </div>

      <div class="search">
        <input id="searchInput" type="text" placeholder="Search tags / タグ検索" />
        <div id="count" class="count"></div>
      </div>

      <div id="list"></div>

      <div class="bilingual">
        <div class="lang-block lang-visible" data-lang="en">
          <p class="muted">
            For specific tag requests, use the in-app request form. For general tag policy or structure,
            email support. <a href="index.html">Support page</a>
          </p>
        </div>
        <div class="lang-block" data-lang="ja">
          <p class="muted">
            個別のタグの追加・変更はアプリから、Tag 全般のご要望はサポートメールへお願いします。
            <a href="index.html">サポートページ</a>
          </p>
        </div>
        <div class="lang-block" data-lang="ko">
          <p class="muted">
            개별 태그 추가·변경은 앱에서, 태그 전반 관련 요청은 지원 이메일로 문의해 주세요.
            <a href="index.html">지원 페이지</a>
          </p>
        </div>
        <div class="lang-block" data-lang="pt">
          <p class="muted">
            Para pedidos de tags específicos, use o formulário no app. Para política ou estrutura geral, envie e-mail para o suporte. <a href="index.html">Página de suporte</a>
          </p>
        </div>
        <div class="lang-block" data-lang="es">
          <p class="muted">
            Para solicitudes de etiquetas específicas, usa el formulario en la app. Para política o estructura general, escribe al soporte. <a href="index.html">Página de soporte</a>
          </p>
        </div>
        <div class="lang-block" data-lang="fr">
          <p class="muted">
            Pour des demandes de tags spécifiques, utilisez le formulaire dans l'app. Pour la politique ou la structure générale, contactez le support par e-mail. <a href="index.html">Page d'assistance</a>
          </p>
        </div>
      </div>
      <div class="bilingual">
        <div class="lang-block lang-visible" data-lang="en">
          <p class="muted">
            We welcome suggestions about the tag system. Jiu-jitsu evolves daily, and we believe more
            community knowledge makes this better. At the same time, we want to keep tags understandable,
            so we will balance clarity and coverage. We would be grateful for advice from experienced
            jiu-jitsu practitioners. For specific tag requests, use the in-app request; for overall policy,
            email support.
          </p>
        </div>
        <div class="lang-block" data-lang="ja">
          <p class="muted">
            Tag の構成や追加・変更のご要望も歓迎しています。柔術は日々進化していますし、多くの方の知見が入るとさらに良くなると感じています。
            ただし、構成が複雑になりすぎないようバランスを見ながら進めたいと考えています。
            柔術家の先輩方にご助言いただけるとありがたいと考えています。
            個別のタグについての追加・変更はアプリからお送りいただくのが便利です。Tag 全般の方針や構成へのご要望はサポートメールまでお願いします。
          </p>
        </div>
        <div class="lang-block" data-lang="ko">
          <p class="muted">
            태그 시스템에 대한 제안을 환영합니다. 주짓수는 매일 진화하며, 커뮤니티 지식이 많을수록 더 좋아진다고 믿습니다. 동시에 태그를 이해하기 쉽게 유지하고자 명확성과 커버리지의 균형을 맞추겠습니다. 경험 많은 주짓수 수련자들의 조언에 감사드립니다. 개별 태그 요청은 앱 내 요청을, 전반적인 정책은 이메일로 문의해 주세요.
          </p>
        </div>
        <div class="lang-block" data-lang="pt">
          <p class="muted">
            Aceitamos sugestões sobre o sistema de tags. O jiu-jitsu evolui diariamente e acreditamos que mais conhecimento da comunidade melhora o sistema. Ao mesmo tempo, queremos manter as tags compreensíveis, equilibrando clareza e cobertura. Agradecemos conselhos de praticantes experientes. Para pedidos específicos, use o formulário no app; para política geral, envie e-mail ao suporte.
          </p>
        </div>
        <div class="lang-block" data-lang="es">
          <p class="muted">
            Aceptamos sugerencias sobre el sistema de etiquetas. El jiu-jitsu evoluciona cada día y creemos que más conocimiento de la comunidad lo mejora. Al mismo tiempo, queremos mantener las etiquetas comprensibles, equilibrando claridad y cobertura. Agradecemos consejos de practicantes experimentados. Para solicitudes específicas, usa el formulario en la app; para política general, escribe al soporte.
          </p>
        </div>
        <div class="lang-block" data-lang="fr">
          <p class="muted">
            Nous accueillons les suggestions sur le système de tags. Le jiu-jitsu évolue chaque jour et nous pensons que les connaissances de la communauté l'améliorent. Nous voulons garder les tags compréhensibles en équilibrant clarté et couverture. Nous serions reconnaissants des conseils de pratiquants expérimentés. Pour des demandes spécifiques, utilisez le formulaire dans l'app ; pour la politique générale, contactez le support par e-mail.
          </p>
        </div>
      </div>
      <p class="lang-block lang-visible muted" data-lang="en">© 2026 Link2Mat. Site content (text, layout) is protected.</p>
      <p class="lang-block muted" data-lang="ja">© 2026 Link2Mat. 本サイトの文章・構成の著作権を保護します。</p>
      <p class="lang-block muted" data-lang="ko">© 2026 Link2Mat. 사이트 내용(텍스트, 구성)은 보호됩니다.</p>
      <p class="lang-block muted" data-lang="pt">© 2026 Link2Mat. Todos os direitos reservados.</p>
      <p class="lang-block muted" data-lang="es">© 2026 Link2Mat. Todos los derechos reservados.</p>
      <p class="lang-block muted" data-lang="fr">© 2026 Link2Mat. Tous droits réservés.</p>
    </div>

    <script>
      (function () {
        const STORAGE_KEY = "link2mat-support-lang";
        const supported = ["en", "ja", "ko", "pt", "es", "fr"];
        const langButtons = document.querySelectorAll(".lang-btn");
        const langBlocks = document.querySelectorAll(".lang-block");

        function detectBrowserLang() {
          const list = navigator.languages && navigator.languages.length ? navigator.languages : [navigator.language || navigator.userLanguage || "en"];
          for (let i = 0; i < list.length; i++) {
            const code = (list[i] || "").toLowerCase().split("-")[0];
            if (supported.indexOf(code) !== -1) return code;
          }
          return "en";
        }

        function resolveLang() {
          try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved && supported.indexOf(saved) !== -1) return saved;
          } catch (e) {}
          const params = new URLSearchParams(window.location.search);
          const raw = String(params.get("lang") || "").toLowerCase();
          if (raw.startsWith("ja")) return "ja";
          if (raw.startsWith("ko")) return "ko";
          if (raw.startsWith("pt")) return "pt";
          if (raw.startsWith("es")) return "es";
          if (raw.startsWith("fr")) return "fr";
          if (raw.startsWith("en")) return "en";
          return detectBrowserLang();
        }

        function setLang(lang) {
          document.body.setAttribute("data-lang", lang);
          langBlocks.forEach(function (el) {
            el.classList.toggle("lang-visible", el.getAttribute("data-lang") === lang);
          });
          langButtons.forEach(function (btn) {
            const on = btn.getAttribute("data-lang") === lang;
            btn.classList.toggle("active", on);
            btn.setAttribute("aria-pressed", on ? "true" : "false");
          });
          try { localStorage.setItem(STORAGE_KEY, lang); } catch (e) {}
        }

        langButtons.forEach(function (btn) {
          btn.addEventListener("click", function () { setLang(btn.getAttribute("data-lang")); });
        });

        const lang = resolveLang();
        setLang(lang);

      // アプリの bodyParts.ts と同じ部位グループ（pre.body.* のみ）。サブカテゴリ表示用。
      const BODY_REGION_TAG_IDS = {
        collar: ["pre.body.collar", "pre.body.collar_front", "pre.body.collar_back", "pre.body.collar_low"],
        knee: ["pre.body.above_knee", "pre.body.knee", "pre.body.knee_side", "pre.body.knee_side_outer", "pre.body.below_knee"],
        waist: ["pre.body.waist", "pre.body.belt_front", "pre.body.belt_side", "pre.body.belt_back", "pre.body.groin", "pre.body.pocket", "pre.body.back_pants", "pre.body.hip_buttock"],
        torso: ["pre.body.shoulder", "pre.body.chest", "pre.body.back", "pre.body.sternum", "pre.body.armpit", "pre.body.belly", "pre.body.side_ribs"],
        elbow: ["pre.body.arm", "pre.body.upper_arm_inner", "pre.body.upper_arm_outer", "pre.body.elbow", "pre.body.elbow_back", "pre.body.elbow_side", "pre.body.forearm_inner", "pre.body.forearm_outer", "pre.body.forearm_blade"],
        hand_below: ["pre.body.sleeve", "pre.body.wrist", "pre.body.hand_thumb_side", "pre.body.hand_pinky_side", "pre.body.palm", "pre.body.back_of_hand", "pre.body.fist", "pre.body.fingers"],
        face_head: ["pre.body.neck", "pre.body.chin", "pre.body.cheek", "pre.body.ear", "pre.body.back_of_head", "pre.body.forehead", "pre.body.philtrum"],
        lower_body: ["pre.body.thigh_front", "pre.body.thigh_side", "pre.body.thigh_side_outer", "pre.body.thigh_back", "pre.body.shin", "pre.body.calf"],
        ankle: ["pre.body.pant_cuff", "pre.body.ankle", "pre.body.ankle_inside", "pre.body.ankle_outside", "pre.body.heel", "pre.body.instep", "pre.body.sole", "pre.body.foot_thumb_side", "pre.body.foot_pinky_side"],
      };
      const BODY_REGION_ORDER = ["face_head", "collar", "torso", "waist", "elbow", "hand_below", "lower_body", "knee", "ankle"];
      // アプリの bodyParts.ts BODY_PART_ELEMENT_TAG_KEYS.other と同じ。部位の「その他」に表示し、アプローチには出さない。
      const BODY_PART_OTHER_TAG_IDS = ["pre.position.front_side", "pre.position.back_side", "pre.position.near_side", "pre.position.far_side", "pre.position.inside", "pre.position.outside", "pre.position.self", "pre.position.opponent", "pre.underhook_side", "pre.overhook_side"];
      const bodyPartOtherSet = new Set(BODY_PART_OTHER_TAG_IDS);
      const SETUP_SUBSECTION_LABELS = {
        ja: { approach: "アプローチ", body_part: "部位", other_setup: "セットアップ（その他）" },
        en: { approach: "Approach", body_part: "Body part", other_setup: "Setup (other)" },
        ko: { approach: "어프로치", body_part: "부위", other_setup: "셋업(기타)" },
        pt: { approach: "Abordagem", body_part: "Parte do corpo", other_setup: "Preparação (outros)" },
        es: { approach: "Enfoque", body_part: "Parte del cuerpo", other_setup: "Preparación (otros)" },
        fr: { approach: "Approche", body_part: "Partie du corps", other_setup: "Préparation (autre)" },
      };
      const BODY_REGION_LABELS = {
        ja: { face_head: "くびから上", collar: "えり周り", torso: "胴体周り", waist: "こし周り", elbow: "うで・ひじ周り", hand_below: "手首から先", lower_body: "下半身", knee: "ひざ周り", ankle: "足首から先", other: "その他" },
        en: { face_head: "Head & Neck", collar: "Collar", torso: "Torso", waist: "Waist", elbow: "Arm & Elbow", hand_below: "Hand / Wrist", lower_body: "Lower body", knee: "Knee", ankle: "Ankle / Foot", other: "Other" },
        ko: { face_head: "머리·목", collar: "칼라", torso: "몸통", waist: "허리", elbow: "팔·팔꿈치", hand_below: "손목부터", lower_body: "하체", knee: "무릎", ankle: "발목부터", other: "기타" },
        pt: { face_head: "Cabeça e pescoço", collar: "Gola", torso: "Tronco", waist: "Cintura", elbow: "Braço e cotovelo", hand_below: "Mão / punho", lower_body: "Parte inferior", knee: "Joelho", ankle: "Tornozelo / pé", other: "Outro" },
        es: { face_head: "Cabeza y cuello", collar: "Cuello", torso: "Tronco", waist: "Cintura", elbow: "Brazo y codo", hand_below: "Mano / muñeca", lower_body: "Parte inferior", knee: "Rodilla", ankle: "Tobillo / pie", other: "Otro" },
        fr: { face_head: "Tête et cou", collar: "Col", torso: "Torse", waist: "Taille", elbow: "Bras et coude", hand_below: "Main / poignet", lower_body: "Bas du corps", knee: "Genou", ankle: "Cheville / pied", other: "Autre" },
      };
      const tagIdToBodyRegion = new Map();
      BODY_REGION_ORDER.forEach((rid) => {
        (BODY_REGION_TAG_IDS[rid] || []).forEach((tid) => tagIdToBodyRegion.set(tid, rid));
      });

      // アプリの bodyParts.ts と同じアプローチフィルターカテゴリ（グリップ・コントロール等）。h4 用。
      const APPROACH_FILTER_CATEGORIES = [
        { id: "grip", tagKeyPrefixes: ["pre.grip.", "pre.seatbelt"] },
        { id: "control", tagKeyPrefixes: ["pre.control", "pre.arm_control", "pre.hip_control", "pre.hip_line_control", "pre.foot_on_hip", "pre.hip_turn", "pre.shoulder_line_control", "pre.knee_line_control", "pre.heel_exposure_control", "pre.head_position", "pre.chin_control", "pre.crossface", "pre.head_pull", "pre.wrist_control", "pre.gift_wrap", "act.control.seatbelt"] },
        { id: "guard", tagKeyPrefixes: ["pos.guard."] },
        { id: "pass", tagKeyPrefixes: ["act.pass.", "pre.arm_triangle_pass", "act.wrestling.body_lock", "pre.reverse_half_guard_pass"] },
        { id: "sweep", tagKeyPrefixes: ["act.guard.sweep.", "pre.shin_sweep"] },
        { id: "escape", tagKeyPrefixes: ["act.escape."] },
        { id: "submission", tagKeyPrefixes: ["act.sub."] },
        { id: "other", tagKeyPrefixes: [] },
      ];
      const APPROACH_CATEGORY_LABELS = {
        ja: { grip: "グリップ", control: "コントロール", guard: "ガード", pass: "パス", sweep: "スイープ", escape: "エスケープ", submission: "サブミッション", other: "その他" },
        en: { grip: "Grip", control: "Control", guard: "Guard", pass: "Pass", sweep: "Sweep", escape: "Escape", submission: "Submission", other: "Other" },
        ko: { grip: "그립", control: "컨트롤", guard: "가드", pass: "패스", sweep: "스윕", escape: "이스케이프", submission: "서브미션", other: "기타" },
        pt: { grip: "Pegada", control: "Controle", guard: "Guarda", pass: "Passagem", sweep: "Varrida", escape: "Fuga", submission: "Finalização", other: "Outro" },
        es: { grip: "Agarre", control: "Control", guard: "Guardia", pass: "Pase", sweep: "Barrida", escape: "Escape", submission: "Finalización", other: "Otro" },
        fr: { grip: "Prise", control: "Contrôle", guard: "Garde", pass: "Passe", sweep: "Balayage", escape: "Évasion", submission: "Soumission", other: "Autre" },
      };
      const PERSPECTIVE_LABELS = {
        ja: { top: "トップから", bottom: "ボトムから", other: "それ以外" },
        en: { top: "From top", bottom: "From bottom", other: "Other" },
        ko: { top: "탑에서", bottom: "바텀에서", other: "기타" },
        pt: { top: "Do topo", bottom: "De baixo", other: "Outros" },
        es: { top: "Desde arriba", bottom: "Desde abajo", other: "Otros" },
        fr: { top: "Du dessus", bottom: "Du dessous", other: "Autres" },
      };
      const APPROACH_PERSPECTIVE_TOP_PREFIXES = ["pre.hip_control", "pre.hip_line_control", "pre.hip_turn", "pre.foot_on_hip", "pre.crossface", "pre.head_position", "pre.chin_control", "pre.head_pull", "pre.control_elbow_line", "pre.control.pin", "pre.shoulder_line_control", "pre.knee_line_control", "pre.heel_exposure_control", "pre.shoulder_drive", "pre.leg_pin", "pre.gift_wrap", "pre.side_switch", "pre.x_pass", "pre.combat_base", "pre.sitting_pass", "act.control.kneeling_base", "act.wrestling.inside_trip", "act.guard.guard_pull", "act.wrestling.cow_catcher", "act.transition.take_back.gator_roll", "act.wrestling.corner_cut", "pre.step_over", "act.movement.step_back", "act.wrestling.snapdown", "act.wrestling.sprawl", "act.control.turtle_breakdown", "act.control.twisting_arm", "act.movement.top_spin", "pre.tripod", "pre.knee_split", "pre.half_nelson", "act.wrestling.high_crotch", "act.wrestling.back_clinch", "act.wrestling.hip_throw", "act.wrestling.fireman_carry", "act.control.head_post", "act.wrestling.body_lock", "act.transition.mount", "act.wrestling.rear_takedown", "pre.level_change", "act.wrestling.arm_throw", "act.wrestling.uchi_mata", "act.wrestling.osoto_gari", "act.wrestling.ouchi_gari", "act.wrestling.kouchi_gari", "act.wrestling.kosoto_gari", "act.control.cross_body", "act.wrestling.spinning_arm_throw"];
      const APPROACH_PERSPECTIVE_BOTTOM_PREFIXES = ["pre.frame", "pre.frame_s", "pre.hip_escape", "pre.posture_break", "pre.waiter", "pre.leg_lasso", "pre.handlebar", "pre.butterfly_hook", "pre.shin_sweep", "pre.cross_hook", "act.guard.inversion", "act.guard.kiss_of_the_dragon", "act.guard.granby_roll", "act.wrestling.cross_over_lift", "act.escape.elbow_escape", "act.escape.overhead", "act.escape.overhead_roll", "act.escape.underhook", "act.guard.sweep", "act.wrestling.switch_sit_out", "act.movement.technical_stand_up", "act.guard.entry", "act.guard.recovery", "act.guard.retention", "act.escape.turtle", "act.movement.shrimp", "act.movement.reverse_shrimp", "act.movement.body_spin", "act.movement.bridge", "act.guard.berimbolo", "act.guard.wrestle_up", "act.guard.leg_scoop", "pre.knee_elbow_connection"];
      function approachFilterCategoryMatches(categoryId, tagKey) {
        const cat = APPROACH_FILTER_CATEGORIES.find(function (c) { return c.id === categoryId; });
        if (!cat) return false;
        if (categoryId === "other") {
          const others = APPROACH_FILTER_CATEGORIES.filter(function (c) { return c.id !== "other" && (c.tagKeyPrefixes || []).length; });
          const inAny = others.some(function (c) {
            return (c.tagKeyPrefixes || []).some(function (p) { return tagKey.startsWith(p); });
          });
          return !inAny;
        }
        return (cat.tagKeyPrefixes || []).some(function (p) { return tagKey.startsWith(p); });
      }
      function getApproachPerspectiveExclusive(tagKey) {
        var top = APPROACH_PERSPECTIVE_TOP_PREFIXES.some(function (p) { return tagKey.startsWith(p) || tagKey === p; });
        var bottom = APPROACH_PERSPECTIVE_BOTTOM_PREFIXES.some(function (p) { return tagKey.startsWith(p) || tagKey === p; });
        if (top && !bottom) return "top";
        if (bottom && !top) return "bottom";
        return "other";
      }

      const categoryLabels =
        lang === "ja"
          ? {
              Position: "ポジション",
              Scenario: "シナリオ",
              Prerequisite: "セットアップ",
              Action: "アクション",
              Submission: "極め",
              Source: "ソース",
            }
          : lang === "ko"
            ? {
                Position: "포지션",
                Scenario: "시나리오",
                Prerequisite: "셋업",
                Action: "액션",
                Submission: "서브미션",
                Source: "소스",
              }
            : lang === "pt"
              ? {
                  Position: "Posição",
                  Scenario: "Cenário",
                  Prerequisite: "Preparação",
                  Action: "Ação",
                  Submission: "Finalização",
                  Source: "Fonte",
                }
              : lang === "es"
                ? {
                    Position: "Posición",
                    Scenario: "Escenario",
                    Prerequisite: "Preparación",
                    Action: "Acción",
                    Submission: "Finalización",
                    Source: "Fuente",
                  }
                : lang === "fr"
                  ? {
                      Position: "Position",
                      Scenario: "Scénario",
                      Prerequisite: "Préparation",
                      Action: "Action",
                      Submission: "Soumission",
                      Source: "Source",
                    }
                  : {
                      Position: "Position",
                      Scenario: "Scenario",
                      Prerequisite: "Setup",
                      Action: "Action",
                      Submission: "Submission",
                      Source: "Source",
                    };

      const list = document.getElementById("list");
      const count = document.getElementById("count");
      const input = document.getElementById("searchInput");
      const placeholders = {
        ja: "タグ検索",
        en: "Search tags",
        ko: "태그 검색",
        pt: "Pesquisar tags",
        es: "Buscar etiquetas",
        fr: "Rechercher des tags",
      };
      const countLabels = {
        ja: "件",
        en: "tags",
        ko: "개",
        pt: "tags",
        es: "etiquetas",
        fr: "tags",
      };
      input.placeholder = `${placeholders[lang] || placeholders.en} / Tag`;

      const normalize = (value) => value.toLowerCase().trim();
      const getLabels = (tag) => (tag.labels && typeof tag.labels === "object" ? tag.labels : {});
      const getAliasesByLocale = (tag) =>
        tag.aliasesByLocale && typeof tag.aliasesByLocale === "object" ? tag.aliasesByLocale : {};
      const resolveLabel = (tag) => {
        const labels = getLabels(tag);
        return (
          labels[lang] ||
          (lang === "ja" ? tag.canonicalJa : tag.canonicalEn) ||
          tag.canonicalJa ||
          tag.canonicalEn ||
          tag.tagId
        );
      };
      const resolveAltLabel = (tag, primary) => {
        const labels = getLabels(tag);
        const alt =
          lang === "ja"
            ? labels.en || tag.canonicalEn
            : labels.ja || tag.canonicalJa;
        if (!alt || alt === primary) return "";
        return alt;
      };
      const resolveAliases = (tag) => {
        const byLocale = getAliasesByLocale(tag);
        if (Array.isArray(byLocale[lang]) && byLocale[lang].length) return byLocale[lang];
        if (Array.isArray(tag.aliases) && tag.aliases.length) return tag.aliases;
        const merged = Object.values(byLocale).flat();
        return merged.filter((value) => typeof value === "string" && value.trim());
      };
      const collectSearchText = (tag) => {
        const labels = Object.values(getLabels(tag));
        const byLocale = Object.values(getAliasesByLocale(tag)).flat();
        return [
          tag.canonicalJa,
          tag.canonicalEn,
          ...labels,
          ...(tag.aliases || []),
          ...byLocale,
        ]
          .filter(Boolean)
          .join(" ");
      };

      const render = (tags, query) => {
        list.innerHTML = "";
        const q = normalize(query || "");
        const filtered = tags.filter((tag) => {
          if (!q) return true;
          return normalize(collectSearchText(tag)).includes(q);
        });

        const unit = countLabels[lang] || countLabels.en;
        count.textContent = `${filtered.length} ${unit}`;

        const byCategory = new Map();
        for (const tag of filtered) {
          const key = tag.category || "Other";
          if (!byCategory.has(key)) byCategory.set(key, []);
          byCategory.get(key).push(tag);
        }

        const order = [
          "Position",
          "Scenario",
          "Prerequisite",
          "Action",
          "Submission",
          "Source",
          "Other",
        ];

        function appendTag(section, tag) {
          const item = document.createElement("div");
          item.className = "tag";
          const heading = document.createElement("div");
          heading.className = "tag-title";
          const link = document.createElement("a");
          link.href = `tags-detail.html?id=${encodeURIComponent(tag.tagId)}&lang=${encodeURIComponent(
            lang
          )}`;
          const primary = resolveLabel(tag);
          link.textContent = primary;
          heading.appendChild(link);

          const alt = resolveAltLabel(tag, primary);
          if (alt) {
            const altSpan = document.createElement("span");
            altSpan.className = "tag-alt";
            altSpan.textContent = `(${alt})`;
            heading.appendChild(altSpan);
          }

          const meta = document.createElement("div");
          meta.className = "tag-meta";
          const aliasText = resolveAliases(tag).join(", ");
          meta.textContent = aliasText ? `Aliases: ${aliasText}` : "";

          item.appendChild(heading);
          if (meta.textContent) item.appendChild(meta);
          section.appendChild(item);
        }

        for (const key of order) {
          if (!byCategory.has(key)) continue;
          const section = document.createElement("div");
          section.className = "section";
          const title = document.createElement("h2");
          title.textContent = categoryLabels[key] || key;
          section.appendChild(title);

          const preTags = byCategory.get(key);
          if (key === "Prerequisite") {
            const bodyTags = preTags.filter((t) => String(t.tagId).startsWith("pre.body.") && tagIdToBodyRegion.has(t.tagId));
            const bodyPartOtherTags = preTags.filter((t) => bodyPartOtherSet.has(String(t.tagId)));
            const otherPreTags = preTags.filter((t) => {
              const tid = String(t.tagId);
              if (tid.startsWith("pre.body.")) return false;
              if (bodyPartOtherSet.has(tid)) return false;
              return true;
            });
            const byRegion = new Map();
            for (const t of bodyTags) {
              const rid = tagIdToBodyRegion.get(t.tagId);
              if (!byRegion.has(rid)) byRegion.set(rid, []);
              byRegion.get(rid).push(t);
            }
            const regionLabels = BODY_REGION_LABELS[lang] || BODY_REGION_LABELS.en;
            const subsectionLabels = SETUP_SUBSECTION_LABELS[lang] || SETUP_SUBSECTION_LABELS.en;
            const approachCatLabels = APPROACH_CATEGORY_LABELS[lang] || APPROACH_CATEGORY_LABELS.en;
            const perspectiveLabels = PERSPECTIVE_LABELS[lang] || PERSPECTIVE_LABELS.en;
            // h3: アプローチ → h4: グリップ/コントロール/ガード/パス/スイープ/エスケープ/サブミッション/その他 → タグ。その他だけ h5: トップから/ボトムから/それ以外
            if (otherPreTags.length) {
              const h3Approach = document.createElement("h3");
              h3Approach.textContent = subsectionLabels.approach || "Approach";
              section.appendChild(h3Approach);
              const byApproachCat = new Map();
              APPROACH_FILTER_CATEGORIES.forEach(function (c) { byApproachCat.set(c.id, []); });
              otherPreTags.forEach(function (tag) {
                var tid = tag.tagId || "";
                for (var i = 0; i < APPROACH_FILTER_CATEGORIES.length; i++) {
                  if (approachFilterCategoryMatches(APPROACH_FILTER_CATEGORIES[i].id, tid)) {
                    byApproachCat.get(APPROACH_FILTER_CATEGORIES[i].id).push(tag);
                    break;
                  }
                }
              });
              APPROACH_FILTER_CATEGORIES.forEach(function (c) {
                const tagsInCat = byApproachCat.get(c.id) || [];
                if (tagsInCat.length === 0) return;
                const h4Cat = document.createElement("h4");
                h4Cat.textContent = approachCatLabels[c.id] || c.id;
                section.appendChild(h4Cat);
                if (c.id === "other") {
                  const byPerspective = { top: [], bottom: [], other: [] };
                  tagsInCat.forEach(function (tag) {
                    const p = getApproachPerspectiveExclusive(tag.tagId || "");
                    byPerspective[p].push(tag);
                  });
                  ["top", "bottom", "other"].forEach(function (perspective) {
                    const list = byPerspective[perspective];
                    if (list.length === 0) return;
                    const h5Perspective = document.createElement("h5");
                    h5Perspective.textContent = perspectiveLabels[perspective] || perspective;
                    section.appendChild(h5Perspective);
                    list.forEach(function (tag) { appendTag(section, tag); });
                  });
                } else {
                  tagsInCat.forEach(function (tag) { appendTag(section, tag); });
                }
              });
            }
            // h3: 部位 → h4: 各部位名 → タグ（BODY_REGION_TAG_IDS に含まれるもののみ表示。未マップの pre.body.* は辞書から削除済みのため表示しない）
            const h3Body = document.createElement("h3");
            h3Body.textContent = subsectionLabels.body_part || "Body part";
            section.appendChild(h3Body);
            for (const rid of BODY_REGION_ORDER) {
              if (!byRegion.has(rid)) continue;
              const h4Region = document.createElement("h4");
              h4Region.textContent = regionLabels[rid] || rid;
              section.appendChild(h4Region);
              for (const tag of byRegion.get(rid)) appendTag(section, tag);
            }
            if (bodyPartOtherTags.length) {
              const h4Other = document.createElement("h4");
              h4Other.textContent = regionLabels.other || "Other";
              section.appendChild(h4Other);
              for (const tag of bodyPartOtherTags) appendTag(section, tag);
            }
          } else {
            for (const tag of preTags) appendTag(section, tag);
          }

          list.appendChild(section);
        }
      };

      fetch("tags-data.json")
        .then((res) => res.json())
        .then((data) => {
          const tags = data.tags || [];
          render(tags, "");
          input.addEventListener("input", () => render(tags, input.value));
        })
        .catch(() => {
          list.innerHTML = "<p>Failed to load tag list.</p>";
        });

      })();
    </script>
  </body>
</html>
