<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag List / タグ一覧</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        margin: 0;
        padding: 32px 20px;
        background: #ffffff;
        color: #111111;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
      }
      h2 {
        font-size: 18px;
        margin: 24px 0 8px;
      }
      p {
        line-height: 1.6;
        margin: 12px 0;
      }
      .muted {
        color: #4b5563;
        font-size: 13px;
      }
      .search {
        margin-top: 16px;
        margin-bottom: 12px;
      }
      input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        font-size: 14px;
      }
      .count {
        margin-top: 6px;
        font-size: 13px;
        color: #6b7280;
      }
      .section {
        border-top: 1px solid #e5e7eb;
        padding-top: 16px;
        margin-top: 16px;
      }
      .tag {
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        margin: 8px 0;
        background: #f9fafb;
      }
      .tag-title {
        font-weight: 700;
      }
      .tag-title a {
        color: #111111;
        text-decoration: none;
      }
      .tag-title a:hover {
        text-decoration: underline;
      }
      .tag-en {
        color: #6b7280;
        font-size: 13px;
        margin-left: 6px;
      }
      .tag-meta {
        color: #6b7280;
        font-size: 12px;
        margin-top: 6px;
      }
      a {
        color: #2563eb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Tag List / タグ一覧</h1>
      <p class="muted"><strong>Last updated:</strong> 2026-01-29</p>
      <p class="muted"><strong>更新日:</strong> 2026-01-29</p>

      <p>
        検索欄でタグを絞り込みできます。タグはポジション / シナリオ / セットアップ /
        アクション / サブミッション / ソースのカテゴリで整理しています。
      </p>

      <div class="search">
        <input id="searchInput" type="text" placeholder="Search tags / タグ検索" />
        <div id="count" class="count"></div>
      </div>

      <div id="list"></div>

      <p class="muted">
        タグの追加要望はサポートまでご連絡ください。
        <a href="index.html">Support page</a>
      </p>
      <p class="muted">
        Tag の構成や追加・変更のご要望も歓迎しています。柔術は日々進化していますし、多くの方の知見が入るとさらに良くなると感じています。
        ただし、構成が複雑になりすぎないようバランスを見ながら進めたいと考えています。
        柔道家の先輩方にご助言いただけるとありがたいと考えています。
      </p>
    </div>

    <script>
      const categoryLabels = {
        Position: "Position / ポジション",
        Scenario: "Scenario / シナリオ",
        Prerequisite: "Setup / セットアップ",
        Action: "Action / アクション",
        Submission: "Submission / 極め",
        Source: "Source / ソース",
      };

      const list = document.getElementById("list");
      const count = document.getElementById("count");
      const input = document.getElementById("searchInput");

      const normalize = (value) => value.toLowerCase().trim();

      const render = (tags, query) => {
        list.innerHTML = "";
        const q = normalize(query || "");
        const filtered = tags.filter((tag) => {
          if (!q) return true;
          const text = [tag.canonicalJa, tag.canonicalEn, ...(tag.aliases || [])]
            .filter(Boolean)
            .join(" ");
          return normalize(text).includes(q);
        });

        count.textContent = `${filtered.length} tags`;

        const byCategory = new Map();
        for (const tag of filtered) {
          const key = tag.category || "Other";
          if (!byCategory.has(key)) byCategory.set(key, []);
          byCategory.get(key).push(tag);
        }

        const order = [
          "Position",
          "Scenario",
          "Prerequisite",
          "Action",
          "Submission",
          "Source",
          "Other",
        ];
        for (const key of order) {
          if (!byCategory.has(key)) continue;
          const section = document.createElement("div");
          section.className = "section";
          const title = document.createElement("h2");
          title.textContent = categoryLabels[key] || key;
          section.appendChild(title);

          for (const tag of byCategory.get(key)) {
            const item = document.createElement("div");
            item.className = "tag";
            const heading = document.createElement("div");
            heading.className = "tag-title";
            const link = document.createElement("a");
            link.href = `tags-detail.html?id=${encodeURIComponent(tag.tagId)}`;
            link.textContent = tag.canonicalJa || tag.canonicalEn || tag.tagId;
            heading.appendChild(link);

            if (tag.canonicalEn) {
              const en = document.createElement("span");
              en.className = "tag-en";
              en.textContent = tag.canonicalEn;
              heading.appendChild(en);
            }

            const meta = document.createElement("div");
            meta.className = "tag-meta";
            const aliasText = (tag.aliases || []).join(", ");
            meta.textContent = aliasText ? `Aliases: ${aliasText}` : "";

            item.appendChild(heading);
            if (meta.textContent) item.appendChild(meta);
            section.appendChild(item);
          }

          list.appendChild(section);
        }
      };

      fetch("tags-data.json")
        .then((res) => res.json())
        .then((data) => {
          const tags = data.tags || [];
          render(tags, "");
          input.addEventListener("input", () => render(tags, input.value));
        })
        .catch(() => {
          list.innerHTML = "<p>Failed to load tag list.</p>";
        });
    </script>
  </body>
</html>
