<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag List / タグ一覧</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        margin: 0;
        padding: 32px 20px;
        background: #ffffff;
        color: #111111;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
      }
      h2 {
        font-size: 18px;
        margin: 24px 0 8px;
      }
      p {
        line-height: 1.6;
        margin: 12px 0;
      }
      .muted {
        color: #4b5563;
        font-size: 13px;
      }
      .search {
        margin-top: 16px;
        margin-bottom: 12px;
      }
      input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        font-size: 14px;
      }
      .count {
        margin-top: 6px;
        font-size: 13px;
        color: #6b7280;
      }
      .section {
        border-top: 1px solid #e5e7eb;
        padding-top: 16px;
        margin-top: 16px;
      }
      .tag {
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        margin: 8px 0;
        background: #f9fafb;
      }
      .tag-title {
        font-weight: 700;
      }
      .tag-title a {
        color: #111111;
        text-decoration: none;
      }
      .tag-title a:hover {
        text-decoration: underline;
      }
      .tag-en {
        color: #6b7280;
        font-size: 13px;
        margin-left: 6px;
        text-decoration: none;
      }
      .tag-alt {
        color: #6b7280;
        font-size: 13px;
        margin-left: 6px;
      }
      .tag-en:hover {
        text-decoration: underline;
      }
      .tag-meta {
        color: #6b7280;
        font-size: 12px;
        margin-top: 6px;
      }
      .bilingual {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 16px;
        align-items: start;
      }
      .bilingual > div > p:first-child {
        margin-top: 0;
      }
      @media (max-width: 860px) {
        .bilingual {
          grid-template-columns: 1fr;
        }
      }
      a {
        color: #2563eb;
      }
      .lang-switch {
        display: flex;
        gap: 8px;
        margin: 12px 0 4px;
        flex-wrap: wrap;
      }
      .lang-switch a {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        font-size: 12px;
        text-decoration: none;
        color: #111111;
        background: #ffffff;
      }
      .lang-switch a.active {
        background: #f3f4f6;
        border-color: #cbd5f5;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Tag List / タグ一覧</h1>
      <p class="muted"><strong>Last updated:</strong> 2026-01-29</p>
      <p class="muted"><strong>更新日:</strong> 2026-01-29</p>

      <div class="lang-switch" id="langSwitch">
        <a href="?lang=ja" data-lang="ja">日本語</a>
        <a href="?lang=en" data-lang="en">English</a>
        <a href="?lang=ko" data-lang="ko">한국어</a>
        <a href="?lang=pt" data-lang="pt">Português</a>
        <a href="?lang=es" data-lang="es">Español</a>
        <a href="?lang=fr" data-lang="fr">Français</a>
      </div>

      <div class="bilingual">
        <div>
          <p>
            Use the search box to filter tags. Tags are grouped into Position, Scenario, Setup, Action,
            Submission, and Source categories.
          </p>
        </div>
        <div>
          <p>
            検索欄でタグを絞り込みできます。タグはポジション / シナリオ / セットアップ /
            アクション / サブミッション / ソースのカテゴリで整理しています。
          </p>
        </div>
      </div>

      <div class="search">
        <input id="searchInput" type="text" placeholder="Search tags / タグ検索" />
        <div id="count" class="count"></div>
      </div>

      <div id="list"></div>

      <div class="bilingual">
        <div>
          <p class="muted">
            For specific tag requests, use the in-app request form. For general tag policy or structure,
            email support. <a id="supportLinkEn" href="index.html">Support page</a>
          </p>
        </div>
        <div>
          <p class="muted">
            個別のタグの追加・変更はアプリから、Tag 全般のご要望はサポートメールへお願いします。
            <a id="supportLinkJa" href="index.html">Support page</a>
          </p>
        </div>
      </div>
      <div class="bilingual">
        <div>
          <p class="muted">
            We welcome suggestions about the tag system. Jiu-jitsu evolves daily, and we believe more
            community knowledge makes this better. At the same time, we want to keep tags understandable,
            so we will balance clarity and coverage. We would be grateful for advice from experienced
            jiu-jitsu practitioners. For specific tag requests, use the in-app request; for overall policy,
            email support.
          </p>
        </div>
        <div>
          <p class="muted">
            Tag の構成や追加・変更のご要望も歓迎しています。柔術は日々進化していますし、多くの方の知見が入るとさらに良くなると感じています。
            ただし、構成が複雑になりすぎないようバランスを見ながら進めたいと考えています。
            柔術家の先輩方にご助言いただけるとありがたいと考えています。
            個別のタグについての追加・変更はアプリからお送りいただくのが便利です。Tag 全般の方針や構成へのご要望はサポートメールまでお願いします。
          </p>
        </div>
      </div>
      <p class="muted">© 2026 Link2Mat. Site content (text, layout) is protected.</p>
      <p class="muted">© 2026 Link2Mat. 本サイトの文章・構成の著作権を保護します。</p>
    </div>

    <script>
      const resolveLang = () => {
        const params = new URLSearchParams(window.location.search);
        const raw = String(params.get("lang") || "").toLowerCase();
        if (raw.startsWith("ja")) return "ja";
        if (raw.startsWith("ko")) return "ko";
        if (raw.startsWith("pt")) return "pt";
        if (raw.startsWith("es")) return "es";
        if (raw.startsWith("fr")) return "fr";
        if (raw.startsWith("en")) return "en";
        const nav = String(navigator.language || "").toLowerCase();
        if (nav.startsWith("ja")) return "ja";
        if (nav.startsWith("ko")) return "ko";
        if (nav.startsWith("pt")) return "pt";
        if (nav.startsWith("es")) return "es";
        if (nav.startsWith("fr")) return "fr";
        return "en";
      };

      const lang = resolveLang();
      const langSwitch = document.getElementById("langSwitch");
      const supportLinkEn = document.getElementById("supportLinkEn");
      const supportLinkJa = document.getElementById("supportLinkJa");
      if (langSwitch) {
        langSwitch.querySelectorAll("a").forEach((a) => {
          a.classList.toggle("active", a.getAttribute("data-lang") === lang);
        });
      }
      if (supportLinkEn) supportLinkEn.href = `index.html?lang=${encodeURIComponent(lang)}`;
      if (supportLinkJa) supportLinkJa.href = `index.html?lang=${encodeURIComponent(lang)}`;

      const categoryLabels =
        lang === "ja"
          ? {
              Position: "ポジション",
              Scenario: "シナリオ",
              Prerequisite: "セットアップ",
              Action: "アクション",
              Submission: "極め",
              Source: "ソース",
            }
          : lang === "ko"
            ? {
                Position: "포지션",
                Scenario: "시나리오",
                Prerequisite: "셋업",
                Action: "액션",
                Submission: "서브미션",
                Source: "소스",
              }
            : lang === "pt"
              ? {
                  Position: "Posição",
                  Scenario: "Cenário",
                  Prerequisite: "Preparação",
                  Action: "Ação",
                  Submission: "Finalização",
                  Source: "Fonte",
                }
              : lang === "es"
                ? {
                    Position: "Posición",
                    Scenario: "Escenario",
                    Prerequisite: "Preparación",
                    Action: "Acción",
                    Submission: "Finalización",
                    Source: "Fuente",
                  }
                : lang === "fr"
                  ? {
                      Position: "Position",
                      Scenario: "Scénario",
                      Prerequisite: "Préparation",
                      Action: "Action",
                      Submission: "Soumission",
                      Source: "Source",
                    }
                  : {
                      Position: "Position",
                      Scenario: "Scenario",
                      Prerequisite: "Setup",
                      Action: "Action",
                      Submission: "Submission",
                      Source: "Source",
                    };

      const list = document.getElementById("list");
      const count = document.getElementById("count");
      const input = document.getElementById("searchInput");
      const placeholders = {
        ja: "タグ検索",
        en: "Search tags",
        ko: "태그 검색",
        pt: "Pesquisar tags",
        es: "Buscar etiquetas",
        fr: "Rechercher des tags",
      };
      const countLabels = {
        ja: "件",
        en: "tags",
        ko: "개",
        pt: "tags",
        es: "etiquetas",
        fr: "tags",
      };
      input.placeholder = `${placeholders[lang] || placeholders.en} / Tag`;

      const normalize = (value) => value.toLowerCase().trim();
      const getLabels = (tag) => (tag.labels && typeof tag.labels === "object" ? tag.labels : {});
      const getAliasesByLocale = (tag) =>
        tag.aliasesByLocale && typeof tag.aliasesByLocale === "object" ? tag.aliasesByLocale : {};
      const resolveLabel = (tag) => {
        const labels = getLabels(tag);
        return (
          labels[lang] ||
          (lang === "ja" ? tag.canonicalJa : tag.canonicalEn) ||
          tag.canonicalJa ||
          tag.canonicalEn ||
          tag.tagId
        );
      };
      const resolveAltLabel = (tag, primary) => {
        const labels = getLabels(tag);
        const alt =
          lang === "ja"
            ? labels.en || tag.canonicalEn
            : labels.ja || tag.canonicalJa;
        if (!alt || alt === primary) return "";
        return alt;
      };
      const resolveAliases = (tag) => {
        const byLocale = getAliasesByLocale(tag);
        if (Array.isArray(byLocale[lang]) && byLocale[lang].length) return byLocale[lang];
        if (Array.isArray(tag.aliases) && tag.aliases.length) return tag.aliases;
        const merged = Object.values(byLocale).flat();
        return merged.filter((value) => typeof value === "string" && value.trim());
      };
      const collectSearchText = (tag) => {
        const labels = Object.values(getLabels(tag));
        const byLocale = Object.values(getAliasesByLocale(tag)).flat();
        return [
          tag.canonicalJa,
          tag.canonicalEn,
          ...labels,
          ...(tag.aliases || []),
          ...byLocale,
        ]
          .filter(Boolean)
          .join(" ");
      };

      const render = (tags, query) => {
        list.innerHTML = "";
        const q = normalize(query || "");
        const filtered = tags.filter((tag) => {
          if (!q) return true;
          return normalize(collectSearchText(tag)).includes(q);
        });

        const unit = countLabels[lang] || countLabels.en;
        count.textContent = `${filtered.length} ${unit}`;

        const byCategory = new Map();
        for (const tag of filtered) {
          const key = tag.category || "Other";
          if (!byCategory.has(key)) byCategory.set(key, []);
          byCategory.get(key).push(tag);
        }

        const order = [
          "Position",
          "Scenario",
          "Prerequisite",
          "Action",
          "Submission",
          "Source",
          "Other",
        ];
        for (const key of order) {
          if (!byCategory.has(key)) continue;
          const section = document.createElement("div");
          section.className = "section";
          const title = document.createElement("h2");
          title.textContent = categoryLabels[key] || key;
          section.appendChild(title);

          for (const tag of byCategory.get(key)) {
            const item = document.createElement("div");
            item.className = "tag";
            const heading = document.createElement("div");
            heading.className = "tag-title";
            const link = document.createElement("a");
            link.href = `tags-detail.html?id=${encodeURIComponent(tag.tagId)}&lang=${encodeURIComponent(
              lang
            )}`;
            const primary = resolveLabel(tag);
            link.textContent = primary;
            heading.appendChild(link);

            const alt = resolveAltLabel(tag, primary);
            if (alt) {
              const altSpan = document.createElement("span");
              altSpan.className = "tag-alt";
              altSpan.textContent = `(${alt})`;
              heading.appendChild(altSpan);
            }

            const meta = document.createElement("div");
            meta.className = "tag-meta";
            const aliasText = resolveAliases(tag).join(", ");
            meta.textContent = aliasText ? `Aliases: ${aliasText}` : "";

            item.appendChild(heading);
            if (meta.textContent) item.appendChild(meta);
            section.appendChild(item);
          }

          list.appendChild(section);
        }
      };

      fetch("tags-data.json")
        .then((res) => res.json())
        .then((data) => {
          const tags = data.tags || [];
          render(tags, "");
          input.addEventListener("input", () => render(tags, input.value));
        })
        .catch(() => {
          list.innerHTML = "<p>Failed to load tag list.</p>";
        });
    </script>
  </body>
</html>
