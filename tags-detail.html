<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag Detail / タグ詳細</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        margin: 0;
        padding: 32px 20px;
        background: #ffffff;
        color: #111111;
      }
      .container {
        max-width: 720px;
        margin: 0 auto;
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
      }
      h2 {
        font-size: 18px;
        margin: 24px 0 8px;
      }
      p {
        line-height: 1.6;
        margin: 12px 0;
      }
      .muted {
        color: #4b5563;
        font-size: 13px;
      }
      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: #f3f4f6;
        color: #374151;
        font-size: 12px;
        margin-right: 8px;
      }
      .card {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        background: #f9fafb;
      }
      .list {
        margin: 8px 0 0 16px;
      }
      .row {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 12px;
      }
      .button {
        display: inline-block;
        padding: 10px 14px;
        border-radius: 999px;
        background: #2563eb;
        color: #ffffff;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
      }
      .lang-switcher { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 20px; align-items: center; }
      .lang-switcher span { font-size: 13px; color: #4b5563; margin-right: 4px; }
      .lang-btn { padding: 6px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; font-size: 14px; cursor: pointer; color: #374151; }
      .lang-btn:hover { background: #f9fafb; border-color: #d1d5db; }
      .lang-btn.active { background: #2563eb; border-color: #2563eb; color: #fff; }
      .lang-block { display: none; }
      .lang-block.lang-visible { display: block; }
      a {
        color: #2563eb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="title">Tag Detail / タグ詳細</h1>
      <p class="lang-block lang-visible muted" data-lang="en"><strong>Last updated:</strong> 2026-02-01</p>
      <p class="lang-block muted" data-lang="ja"><strong>更新日:</strong> 2026-02-01</p>
      <p class="lang-block muted" data-lang="ko"><strong>최종 업데이트:</strong> 2026-02-01</p>
      <p class="lang-block muted" data-lang="pt"><strong>Última atualização:</strong> 2026-02-01</p>
      <p class="lang-block muted" data-lang="es"><strong>Última actualización:</strong> 2026-02-01</p>
      <p class="lang-block muted" data-lang="fr"><strong>Dernière mise à jour:</strong> 2026-02-01</p>

      <div class="lang-switcher" role="group" aria-label="Language / 言語">
        <span class="lang-label">Language / 言語:</span>
        <button type="button" class="lang-btn active" data-lang="en" aria-pressed="true">English</button>
        <button type="button" class="lang-btn" data-lang="ja" aria-pressed="false">日本語</button>
        <button type="button" class="lang-btn" data-lang="ko" aria-pressed="false">한국어</button>
        <button type="button" class="lang-btn" data-lang="pt" aria-pressed="false">Português</button>
        <button type="button" class="lang-btn" data-lang="es" aria-pressed="false">Español</button>
        <button type="button" class="lang-btn" data-lang="fr" aria-pressed="false">Français</button>
      </div>

      <div id="content" class="card">
        <p>Loading...</p>
      </div>

      <h2 class="lang-block lang-visible" data-lang="en">Support</h2>
      <h2 class="lang-block" data-lang="ja">サポート</h2>
      <h2 class="lang-block" data-lang="ko">지원</h2>
      <h2 class="lang-block" data-lang="pt">Suporte</h2>
      <h2 class="lang-block" data-lang="es">Soporte</h2>
      <h2 class="lang-block" data-lang="fr">Assistance</h2>
      <p class="lang-block lang-visible" data-lang="en"><a href="index.html">Support page</a></p>
      <p class="lang-block" data-lang="ja"><a href="index.html">サポートページへ</a></p>
      <p class="lang-block" data-lang="ko"><a href="index.html">지원 페이지</a></p>
      <p class="lang-block" data-lang="pt"><a href="index.html">Página de suporte</a></p>
      <p class="lang-block" data-lang="es"><a href="index.html">Página de soporte</a></p>
      <p class="lang-block" data-lang="fr"><a href="index.html">Page d'assistance</a></p>
      <p class="lang-block lang-visible" data-lang="en"><a href="tags-list.html">Tag list</a></p>
      <p class="lang-block" data-lang="ja"><a href="tags-list.html">タグ一覧へ</a></p>
      <p class="lang-block" data-lang="ko"><a href="tags-list.html">태그 목록</a></p>
      <p class="lang-block" data-lang="pt"><a href="tags-list.html">Lista de tags</a></p>
      <p class="lang-block" data-lang="es"><a href="tags-list.html">Lista de etiquetas</a></p>
      <p class="lang-block" data-lang="fr"><a href="tags-list.html">Liste des tags</a></p>
      <p class="lang-block lang-visible muted" data-lang="en">© 2026 Link2Mat. Site content (text, layout) is protected.</p>
      <p class="lang-block muted" data-lang="ja">© 2026 Link2Mat. 本サイトの文章・構成の著作権を保護します。</p>
      <p class="lang-block muted" data-lang="ko">© 2026 Link2Mat. 사이트 내용(텍스트, 구성)은 보호됩니다.</p>
      <p class="lang-block muted" data-lang="pt">© 2026 Link2Mat. Todos os direitos reservados.</p>
      <p class="lang-block muted" data-lang="es">© 2026 Link2Mat. Todos los derechos reservados.</p>
      <p class="lang-block muted" data-lang="fr">© 2026 Link2Mat. Tous droits réservés.</p>
    </div>

    <script>
      (function () {
        const STORAGE_KEY = "link2mat-support-lang";
        const supported = ["en", "ja", "ko", "pt", "es", "fr"];
        const langButtons = document.querySelectorAll(".lang-btn");
        const langBlocks = document.querySelectorAll(".lang-block");

        function detectBrowserLang() {
          const list = navigator.languages && navigator.languages.length ? navigator.languages : [navigator.language || navigator.userLanguage || "en"];
          for (let i = 0; i < list.length; i++) {
            const code = (list[i] || "").toLowerCase().split("-")[0];
            if (supported.indexOf(code) !== -1) return code;
          }
          return "en";
        }

        function resolveLang() {
          try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved && supported.indexOf(saved) !== -1) return saved;
          } catch (e) {}
          const params = new URLSearchParams(window.location.search);
          const raw = String(params.get("lang") || "").toLowerCase();
          if (raw.startsWith("ja")) return "ja";
          if (raw.startsWith("ko")) return "ko";
          if (raw.startsWith("pt")) return "pt";
          if (raw.startsWith("es")) return "es";
          if (raw.startsWith("fr")) return "fr";
          if (raw.startsWith("en")) return "en";
          return detectBrowserLang();
        }

        function setLang(lang) {
          document.body.setAttribute("data-lang", lang);
          document.querySelectorAll(".lang-block").forEach(function (el) {
            el.classList.toggle("lang-visible", el.getAttribute("data-lang") === lang);
          });
          langButtons.forEach(function (btn) {
            const on = btn.getAttribute("data-lang") === lang;
            btn.classList.toggle("active", on);
            btn.setAttribute("aria-pressed", on ? "true" : "false");
          });
          try { localStorage.setItem(STORAGE_KEY, lang); } catch (e) {}
        }

        langButtons.forEach(function (btn) {
          btn.addEventListener("click", function () { setLang(btn.getAttribute("data-lang")); });
        });

        const lang = resolveLang();
        setLang(lang);

      const normalize = (value) => String(value || "").toLowerCase().trim();

      const params = new URLSearchParams(window.location.search);
      const tagId = params.get("id");
      const tagQuery = params.get("tag");
      const isJapanese = lang === "ja";
      const categoryLabels =
        lang === "ja"
          ? {
              Position: "ポジション",
              Scenario: "シナリオ",
              Prerequisite: "セットアップ",
              Action: "アクション",
              Submission: "極め",
              Source: "ソース",
            }
          : lang === "ko"
            ? {
                Position: "포지션",
                Scenario: "시나리오",
                Prerequisite: "셋업",
                Action: "액션",
                Submission: "서브미션",
                Source: "소스",
              }
            : lang === "pt"
              ? {
                  Position: "Posição",
                  Scenario: "Cenário",
                  Prerequisite: "Preparação",
                  Action: "Ação",
                  Submission: "Finalização",
                  Source: "Fonte",
                }
              : lang === "es"
                ? {
                    Position: "Posición",
                    Scenario: "Escenario",
                    Prerequisite: "Preparación",
                    Action: "Acción",
                    Submission: "Finalización",
                    Source: "Fuente",
                  }
                : lang === "fr"
                  ? {
                      Position: "Position",
                      Scenario: "Scénario",
                      Prerequisite: "Préparation",
                      Action: "Action",
                      Submission: "Soumission",
                      Source: "Source",
                    }
                  : {
                      Position: "Position",
                      Scenario: "Scenario",
                      Prerequisite: "Setup",
                      Action: "Action",
                      Submission: "Submission",
                      Source: "Source",
                    };
      const tagQueryRaw = tagQuery ? tagQuery.trim() : "";

      const findTag = (tags) => {
        if (tagId) {
          return tags.find((tag) => tag.tagId === tagId) || null;
        }
        const q = normalize(tagQueryRaw);
        if (!q) return null;
        return (
          tags.find((tag) => normalize(tag.canonicalJa) === q) ||
          tags.find((tag) => normalize(tag.canonicalEn) === q) ||
          tags.find((tag) => (tag.aliases || []).some((a) => normalize(a) === q)) ||
          tags.find((tag) => {
            const labels = tag.labels || {};
            return Object.values(labels).some((value) => normalize(value) === q);
          }) ||
          tags.find((tag) => {
            const byLocale = tag.aliasesByLocale || {};
            return Object.values(byLocale)
              .flat()
              .some((value) => normalize(value) === q);
          }) ||
          null
        );
      };

      const renderNotFound = () => {
        const content = document.getElementById("content");
        content.innerHTML = `
          <p class="lang-block lang-visible" data-lang="en">Tag not found. Try searching from the list.</p>
          <p class="lang-block" data-lang="ja">タグが見つかりません。タグ一覧から検索してください。</p>
          <p class="lang-block" data-lang="ko">태그를 찾을 수 없습니다. 목록에서 검색해 보세요.</p>
          <p class="lang-block" data-lang="pt">Tag não encontrada. Tente buscar na lista.</p>
          <p class="lang-block" data-lang="es">No se encontró la etiqueta. Prueba a buscar en la lista.</p>
          <p class="lang-block" data-lang="fr">Tag introuvable. Essayez de chercher dans la liste.</p>
          <p class="lang-block lang-visible" data-lang="en"><a href="tags-list.html">Tag list</a></p>
          <p class="lang-block" data-lang="ja"><a href="tags-list.html">タグ一覧へ</a></p>
          <p class="lang-block" data-lang="ko"><a href="tags-list.html">태그 목록</a></p>
          <p class="lang-block" data-lang="pt"><a href="tags-list.html">Lista de tags</a></p>
          <p class="lang-block" data-lang="es"><a href="tags-list.html">Lista de etiquetas</a></p>
          <p class="lang-block" data-lang="fr"><a href="tags-list.html">Liste des tags</a></p>
        `;
        setLang(lang);
      };

      const renderTag = (tag) => {
        const content = document.getElementById("content");
        const title = document.getElementById("title");
        const labels = tag.labels || {};
        const display =
          labels[lang] ||
          (lang === "ja" ? tag.canonicalJa : tag.canonicalEn) ||
          tag.canonicalJa ||
          tag.canonicalEn ||
          tag.tagId;
        const titleSuffix =
          lang === "ja"
            ? "タグ詳細"
            : lang === "ko"
            ? "태그 상세"
            : lang === "pt"
            ? "Detalhe da tag"
            : lang === "es"
            ? "Detalle de la etiqueta"
            : lang === "fr"
            ? "Détail du tag"
            : "Tag Detail";
        title.textContent = `${display} / ${titleSuffix}`;

        const byLocale = tag.aliasesByLocale || {};
        const aliasText = (byLocale[lang] && byLocale[lang].length
          ? byLocale[lang]
          : tag.aliases || []
        )
          .filter(Boolean)
          .join(", ");
        const related = (tag.related || []).map(
          (id) =>
            `<li><a href="tags-detail.html?id=${encodeURIComponent(
              id
            )}&lang=${encodeURIComponent(lang)}">${id}</a></li>`
        );
        const category = categoryLabels[tag.category] || tag.category || "Other";

        const query =
          tagQueryRaw ||
          display ||
          tag.tagId;
        const phrase =
          lang === "ja"
            ? `柔術で "${query}" とは`
            : lang === "ko"
            ? `주짓수 "${query}"`
            : lang === "pt"
            ? `jiu-jitsu "${query}"`
            : lang === "es"
            ? `jiu-jitsu "${query}"`
            : lang === "fr"
            ? `jiu-jitsu "${query}"`
            : `jiu jitsu "${query}"`;
        const webSearch = `https://www.google.com/search?q=${encodeURIComponent(phrase)}`;

        const searchLabel =
          lang === "ja"
            ? "Webで検索"
            : lang === "ko"
            ? "웹에서 검색"
            : lang === "pt"
            ? "Pesquisar na web"
            : lang === "es"
            ? "Buscar en la web"
            : lang === "fr"
            ? "Rechercher sur le web"
            : "Search the web";
        content.innerHTML = `
          <p><span class="badge">${category}</span><span class="badge">${tag.tagId}</span></p>
          <p><strong>${display}</strong> ${
            tag.canonicalEn && tag.canonicalEn !== display ? `(${tag.canonicalEn})` : ""
          }</p>
          ${aliasText ? `<p><strong>Aliases:</strong> ${aliasText}</p>` : "<p><strong>Aliases:</strong> -</p>"}
          <div>
            <p><strong>Related tags:</strong></p>
            ${related.length ? `<ul class="list">${related.join("")}</ul>` : "<p>-</p>"}
          </div>
          <div class="row">
            <a class="button" href="${webSearch}" target="_blank" rel="noreferrer">
              ${searchLabel}
            </a>
          </div>
        `;
      };

      fetch("tags-data.json")
        .then((res) => res.json())
        .then((data) => {
          const tags = data.tags || [];
          const tag = findTag(tags);
          if (!tag) {
            renderNotFound();
          } else {
            renderTag(tag);
          }
        })
        .catch(() => renderNotFound());

      })();
    </script>
  </body>
</html>
