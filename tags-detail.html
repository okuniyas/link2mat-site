<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tag Detail / タグ詳細</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        margin: 0;
        padding: 32px 20px;
        background: #ffffff;
        color: #111111;
      }
      .container {
        max-width: 720px;
        margin: 0 auto;
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
      }
      h2 {
        font-size: 18px;
        margin: 24px 0 8px;
      }
      p {
        line-height: 1.6;
        margin: 12px 0;
      }
      .muted {
        color: #4b5563;
        font-size: 13px;
      }
      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: #f3f4f6;
        color: #374151;
        font-size: 12px;
        margin-right: 8px;
      }
      .card {
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        background: #f9fafb;
      }
      .list {
        margin: 8px 0 0 16px;
      }
      .row {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 12px;
      }
      .button {
        display: inline-block;
        padding: 10px 14px;
        border-radius: 999px;
        background: #2563eb;
        color: #ffffff;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
      }
      .lang-switch {
        display: flex;
        gap: 8px;
        margin: 12px 0 4px;
        flex-wrap: wrap;
      }
      .lang-switch a {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        font-size: 12px;
        text-decoration: none;
        color: #111111;
        background: #ffffff;
      }
      .lang-switch a.active {
        background: #f3f4f6;
        border-color: #cbd5f5;
        font-weight: 600;
      }
      a {
        color: #2563eb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="title">Tag Detail / タグ詳細</h1>
      <p class="muted"><strong>Last updated:</strong> 2026-01-29</p>
      <p class="muted"><strong>更新日:</strong> 2026-01-29</p>

      <div class="lang-switch" id="langSwitch">
        <a href="?lang=ja" data-lang="ja">日本語</a>
        <a href="?lang=en" data-lang="en">English</a>
        <a href="?lang=ko" data-lang="ko">한국어</a>
        <a href="?lang=pt" data-lang="pt">Português</a>
      </div>

      <div id="content" class="card">
        <p>Loading...</p>
      </div>

      <h2>Support / サポート</h2>
      <p><a id="supportLink" href="index.html">Support page / サポートページへ</a></p>
      <p><a id="tagListLink" href="tags-list.html">Tag list / タグ一覧へ</a></p>
      <p class="muted">© 2026 Link2Mat. Site content (text, layout) is protected.</p>
      <p class="muted">© 2026 Link2Mat. 本サイトの文章・構成の著作権を保護します。</p>
    </div>

    <script>
      const resolveLang = () => {
        const params = new URLSearchParams(window.location.search);
        const raw = String(params.get("lang") || "").toLowerCase();
        if (raw.startsWith("ja")) return "ja";
        if (raw.startsWith("ko")) return "ko";
        if (raw.startsWith("pt")) return "pt";
        if (raw.startsWith("en")) return "en";
        const nav = String(navigator.language || "").toLowerCase();
        if (nav.startsWith("ja")) return "ja";
        if (nav.startsWith("ko")) return "ko";
        if (nav.startsWith("pt")) return "pt";
        return "en";
      };

      const normalize = (value) => String(value || "").toLowerCase().trim();

      const params = new URLSearchParams(window.location.search);
      const tagId = params.get("id");
      const tagQuery = params.get("tag");
      const tagQueryRaw = tagQuery ? tagQuery.trim() : "";
      const lang = resolveLang();
      const supportLink = document.getElementById("supportLink");
      const tagListLink = document.getElementById("tagListLink");
      const langSwitch = document.getElementById("langSwitch");
      if (langSwitch) {
        langSwitch.querySelectorAll("a").forEach((a) => {
          a.classList.toggle("active", a.getAttribute("data-lang") === lang);
        });
      }
      if (supportLink) {
        supportLink.href = `index.html?lang=${encodeURIComponent(lang)}`;
      }
      if (tagListLink) {
        tagListLink.href = `tags-list.html?lang=${encodeURIComponent(lang)}`;
      }
      const isJapanese = lang === "ja";
      const categoryLabels =
        lang === "ja"
          ? {
              Position: "ポジション",
              Scenario: "シナリオ",
              Prerequisite: "セットアップ",
              Action: "アクション",
              Submission: "極め",
              Source: "ソース",
            }
          : {
              Position: "Position",
              Scenario: "Scenario",
              Prerequisite: "Setup",
              Action: "Action",
              Submission: "Submission",
              Source: "Source",
            };

      const findTag = (tags) => {
        if (tagId) {
          return tags.find((tag) => tag.tagId === tagId) || null;
        }
        const q = normalize(tagQueryRaw);
        if (!q) return null;
        return (
          tags.find((tag) => normalize(tag.canonicalJa) === q) ||
          tags.find((tag) => normalize(tag.canonicalEn) === q) ||
          tags.find((tag) => (tag.aliases || []).some((a) => normalize(a) === q)) ||
          tags.find((tag) => {
            const labels = tag.labels || {};
            return Object.values(labels).some((value) => normalize(value) === q);
          }) ||
          tags.find((tag) => {
            const byLocale = tag.aliasesByLocale || {};
            return Object.values(byLocale)
              .flat()
              .some((value) => normalize(value) === q);
          }) ||
          null
        );
      };

      const renderNotFound = () => {
        const content = document.getElementById("content");
        content.innerHTML = `
          <p>Tag not found. Try searching from the list.</p>
          <p>タグが見つかりません。タグ一覧から検索してください。</p>
          <p><a href="tags-list.html?lang=${encodeURIComponent(
            lang
          )}">Tag list / タグ一覧へ</a></p>
        `;
      };

      const renderTag = (tag) => {
        const content = document.getElementById("content");
        const title = document.getElementById("title");
        const labels = tag.labels || {};
        const display =
          labels[lang] ||
          (lang === "ja" ? tag.canonicalJa : tag.canonicalEn) ||
          tag.canonicalJa ||
          tag.canonicalEn ||
          tag.tagId;
        title.textContent = `${display} / タグ詳細`;

        const byLocale = tag.aliasesByLocale || {};
        const aliasText = (byLocale[lang] && byLocale[lang].length
          ? byLocale[lang]
          : tag.aliases || []
        )
          .filter(Boolean)
          .join(", ");
        const related = (tag.related || []).map(
          (id) =>
            `<li><a href="tags-detail.html?id=${encodeURIComponent(
              id
            )}&lang=${encodeURIComponent(lang)}">${id}</a></li>`
        );
        const category = categoryLabels[tag.category] || tag.category || "Other";

        const query =
          tagQueryRaw ||
          display ||
          tag.tagId;
        const phrase =
          lang === "ja"
            ? `柔術で "${query}" とは`
            : lang === "ko"
            ? `주짓수 "${query}"`
            : lang === "pt"
            ? `jiu-jitsu "${query}"`
            : `jiu jitsu "${query}"`;
        const webSearch = `https://www.google.com/search?q=${encodeURIComponent(phrase)}`;
        const searchLabel =
          lang === "ja"
            ? "Webで検索"
            : lang === "ko"
            ? "웹에서 검색"
            : lang === "pt"
            ? "Pesquisar na web"
            : "Search the web";

        content.innerHTML = `
          <p><span class="badge">${category}</span><span class="badge">${tag.tagId}</span></p>
          <p><strong>${display}</strong> ${
            tag.canonicalEn && tag.canonicalEn !== display ? `(${tag.canonicalEn})` : ""
          }</p>
          ${aliasText ? `<p><strong>Aliases:</strong> ${aliasText}</p>` : "<p><strong>Aliases:</strong> -</p>"}
          <div>
            <p><strong>Related tags:</strong></p>
            ${related.length ? `<ul class="list">${related.join("")}</ul>` : "<p>-</p>"}
          </div>
          <div class="row">
            <a class="button" href="${webSearch}" target="_blank" rel="noreferrer">
              ${searchLabel}
            </a>
          </div>
        `;
      };

      fetch("tags-data.json")
        .then((res) => res.json())
        .then((data) => {
          const tags = data.tags || [];
          const tag = findTag(tags);
          if (!tag) {
            renderNotFound();
          } else {
            renderTag(tag);
          }
        })
        .catch(() => renderNotFound());
    </script>
  </body>
</html>
